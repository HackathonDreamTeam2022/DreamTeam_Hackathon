gcloud sql connect ui-backend-test  --user=postgres

CREATE TABLE IF NOT EXISTS test2.companies (
   Company VARCHAR ( 50 ) NOT NULL,
   Ticker VARCHAR ( 50 ) NOT NULL
);

CREATE TABLE IF NOT EXISTS test2.stock_price (
   Date VARCHAR ( 50 ) NOT NULL,
   Company VARCHAR ( 50 ) NOT NULL,
   price REAL NOT NULL
);

CREATE TABLE IF NOT EXISTS test2.gdelt_out (
   URL VARCHAR ( 200 ) NOT NULL,
   Date VARCHAR ( 50 ) NOT NULL,
   CorpusScore REAL NOT NULL,
   SentimentScore REAL NOT NULL,
   Company VARCHAR ( 50 ) NOT NULL,
   Time VARCHAR ( 50 ) NOT NULL
);

CREATE TABLE IF NOT EXISTS main.company_mappings (
   Name VARCHAR ( 200 ) NOT NULL,
   Code VARCHAR ( 50 ) NOT NULL
);


CREATE TABLE IF NOT EXISTS main.company_mappings_mid (
   Name VARCHAR ( 200 ) NOT NULL,
   Code VARCHAR ( 50 ) NOT NULL,
   id VARCHAR ( 50 ),
   url VARCHAR ( 500 ),
   mid VARCHAR ( 50 ),
   image_url VARCHAR ( 500 )
   gkg_name VARCHAR ( 200 ),
);


CREATE TABLE IF NOT EXISTS main.nasdaq_history (
   Date VARCHAR ( 50 ) NOT NULL,
   Ticker VARCHAR ( 10 ) NOT NULL,
   Close REAL,
   High REAL,
   Low REAL, 
   Open REAL, 
   VOLUME INTEGER
);

CREATE VIEW main.gdelt_events_coded AS
    SELECT
    A.*,
    B.code,
    CAST(DATE(A.article_dttm) AS CHAR(10)) as clean_date
    FROM gdelt_events_2 A
    INNER JOIN main.company_mappings_mid B
    ON A.mid = b.mid;



CREATE VIEW main.stock_clean AS
    SELECT
    A.*,
    CONCAT(SUBSTRING(date, 7, 4), '-', SUBSTRING(date, 4, 2), '-', SUBSTRING(date, 1, 2)) as clean_date
    FROM main.nasdaq_history A


CREATE VIEW main.stock_events AS
    SELECT
    A.clean_date as date,
    A.gdelt_entity_name as name,
    A.corpus_score,
    A.sentiment_score,
    A.code,
    B.close
    FROM main.gdelt_events_coded A
    INNER JOIN main.stock_clean B
    ON A.code = B.ticker
    AND A.clean_date = B.clean_date

